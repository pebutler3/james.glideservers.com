Ext.namespace("Ext.ux.form"),Ext.ux.form.SuperBoxSelect=function(a){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,a),this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear","autoSize","addItemBox")},Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{allowAddNewData:!1,backspaceDeletesLastItem:!0,classField:null,clearBtnCls:"",displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:!0,forceFormValue:!0,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:!0,pinList:!0,preventDuplicates:!0,queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:!0,renderFieldBtns:!0,stackItems:!1,styleField:null,supressClearValueRemoveEvents:!1,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(!1),usedRecords:new Ext.util.MixedCollection(!1),addedRecords:[],remoteLookup:[],hideTrigger:!0,grow:!1,resizable:!1,multiSelectMode:!1,preRenderValue:null}),this.transform&&this.doTransform(),this.forceFormValue&&this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this}),Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this),"remote"===this.mode&&this.store&&this.store.on("load",this.onStoreLoad,this)},onRender:function(a,b){var c=this.hiddenName;this.hiddenName=null,Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,a,b),this.hiddenName=c,this.manageNameAttribute();var d=this.stackItems===!0?"x-superboxselect-stacked":"";this.renderFieldBtns&&(d+=" x-superboxselect-display-btns"),this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field"),this.wrapEl=this.el.wrap({tag:"ul"}),this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+d}),this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"}),this.renderFieldBtns&&this.setupFieldButtons().manageClearBtn(),this.setupFormInterception()},onStoreLoad:function(a,b,c){var d=c.params[this.queryParam]||a.baseParams[this.queryParam]||"",e=c.params[this.queryValuesIndicator]||a.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore&&this.store.each(function(a){this.usedRecords.containsKey(a.get(this.valueField))&&this.store.remove(a)},this),e){var f=d.split(this.queryValuesDelimiter);Ext.each(f,function(a){this.remoteLookup.remove(a);var b=this.findRecord(this.valueField,a);b&&this.addRecord(b)},this),this.setOriginal&&(this.setOriginal=!1,this.originalValue=this.getValue())}""!==d&&this.allowAddNewData&&Ext.each(this.remoteLookup,function(a){if("object"==typeof a&&a[this.displayField]==d){if(this.remoteLookup.remove(a),b.length&&b[0].get(this.displayField)===d)return void this.addRecord(b[0]);var c=this.createRecord(a);return this.store.add(c),this.addRecord(c),this.addedRecords.push(c),void function(){this.isExpanded()&&this.collapse()}.defer(10,this)}},this);var g=[];if(""===d)Ext.each(this.addedRecords,function(a){this.preventDuplicates&&this.usedRecords.containsKey(a.get(this.valueField))||g.push(a)},this);else{var h=new RegExp(Ext.escapeRe(d)+".*","i");Ext.each(this.addedRecords,function(a){this.preventDuplicates&&this.usedRecords.containsKey(a.get(this.valueField))||h.test(a.get(this.displayField))&&g.push(a)},this)}this.store.add(g),this.store.sort(this.displayField,"ASC"),0===this.store.getCount()&&this.isExpanded()&&this.collapse()},doTransform:function(){var a=Ext.getDom(this.transform),b=[];if(!this.store){this.mode="local";for(var c=[],d=a.options,e=0,f=d.length;e<f;e++){var g=d[e],h=Ext.get(g),i=h.getAttributeNS(null,"value")||"",j=h.getAttributeNS(null,"className")||"",k=h.getAttributeNS(null,"style")||"";g.selected&&b.push(i),c.push([i,g.text,j,"string"==typeof k?k:k.cssText])}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:c}),Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"})}b.length&&(this.value=b.join(","))},setupFieldButtons:function(){return this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"}),this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls}),this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls}),this.initButtonEvents(),this},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent(),this.disabled||(this.clearValue(),this.el.focus())},this),this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent(),this.disabled||(this.isExpanded()?this.multiSelectMode=!1:this.pinList&&(this.multiSelectMode=!0),this.onTriggerClick())},this)},removeButtonEvents:function(){return this.buttonClear.removeAllListeners(),this.buttonExpand.removeAllListeners(),this},clearCurrentFocus:function(){return this.currentFocus&&(this.currentFocus.onLnkBlur(),this.currentFocus=null),this},initEvents:function(){var a=this.el;a.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});var b=this;Ext.isWebKit?a.dom.addEventListener("copy",function(a){a.clipboardData&&(a.preventDefault(),a.clipboardData.setData("text/plain",b.getValue()))}):Ext.isIE&&a.dom.addEventListener("beforecopy",function(a){window.clipboardData&&(a.returnValue=!1,window.clipboardData.setData("Text",b.getValue()))}),this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this}),this.wrapEl.on("click",this.onWrapClick,this),this.outerWrapEl.on("click",this.onWrapClick,this),this.inputEl.focus=function(){a.focus()},Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this),Ext.apply(this.keyNav,{tab:function(b){return this.fixFocusOnTabSelect&&this.isExpanded()?(b.stopEvent(),a.blur(),this.onViewClick(!1),this.focus(!1,10),!0):(this.onViewClick(!1),""!==a.dom.value&&this.setRawValue(""),!0)},down:function(a){this.isExpanded()||this.currentFocus?(this.inKeyMode=!0,this.selectNext()):this.onTriggerClick()},enter:function(){}})},onClick:function(){this.clearCurrentFocus(),this.collapse(),this.autoSize()},beforeBlur:Ext.form.ComboBox.superclass.beforeBlur,onFocus:function(){this.outerWrapEl.addClass(this.focusClass),Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass),this.clearCurrentFocus(),""!==this.el.dom.value&&(this.allowAddNewData?this.fireEvent("newitem",this,this.el.dom.value):this.applyEmptyText(),this.autoSize()),Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)},onCollapse:function(){this.view.clearSelections(),this.multiSelectMode=!1},onWrapClick:function(a){a.stopEvent(),this.collapse(),this.el.focus(),this.clearCurrentFocus()},markInvalid:function(a){var b,c;if(this.rendered&&!this.preventMark){switch(this.outerWrapEl.addClass(this.invalidClass),a=a||this.invalidText,this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:a,qclass:"x-form-invalid-tip"}),Ext.apply(this.wrapEl.dom,{qtip:a,qclass:"x-form-invalid-tip"}),Ext.QuickTips&&Ext.QuickTips.enable();break;case"title":this.el.dom.title=a,this.wrapEl.dom.title=a,this.outerWrapEl.dom.title=a;break;case"under":if(!this.errorEl){if(b=this.getErrorCt(),!b){this.el.dom.title=a;break}this.errorEl=b.createChild({cls:"x-form-invalid-msg"}),this.errorEl.setWidth(b.getWidth(!0)-20)}this.errorEl.update(a),Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){if(b=this.getErrorCt(),!b){this.el.dom.title=a;break}this.errorIcon=b.createChild({cls:"x-form-invalid-icon"})}this.alignErrorIcon(),Ext.apply(this.errorIcon.dom,{qtip:a,qclass:"x-form-invalid-tip"}),this.errorIcon.show(),this.on("resize",this.alignErrorIcon,this);break;default:c=Ext.getDom(this.msgTarget),c.innerHTML=a,c.style.display=this.msgDisplay}this.fireEvent("invalid",this,a)}},clearInvalid:function(){if(this.rendered&&!this.preventMark){switch(this.outerWrapEl.removeClass(this.invalidClass),this.msgTarget){case"qtip":this.el.dom.qtip="",this.wrapEl.dom.qtip="";break;case"title":this.el.dom.title="",this.wrapEl.dom.title="",this.outerWrapEl.dom.title="";break;case"under":this.errorEl&&Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);break;case"side":this.errorIcon&&(this.errorIcon.dom.qtip="",this.errorIcon.hide(),this.un("resize",this.alignErrorIcon,this));break;default:var a=Ext.getDom(this.msgTarget);a.innerHTML="",a.style.display="none"}this.fireEvent("valid",this)}},alignErrorIcon:function(){this.wrap&&this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3])},expand:function(){!this.isExpanded()&&this.hasFocus&&(this.list.alignTo(this.outerWrapEl,this.listAlign).show(),this.innerList.setOverflow("auto"),Ext.getDoc().on({mousewheel:this.collapseIf,mousedown:this.collapseIf,scope:this}),this.fireEvent("expand",this))},restrictHeight:function(){var a=this.innerList.dom,b=a.scrollTop,c=this.list;a.style.height="";var d=c.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,e=Math.max(a.clientHeight,a.offsetHeight,a.scrollHeight),f=this.getPosition()[1]-Ext.getBody().getScroll().top,g=Ext.lib.Dom.getViewHeight()-f-this.getSize().height,h=Math.max(f,g,this.minHeight||0)-d-5;e=Math.min(e,h,this.maxHeight),this.innerList.setHeight(e),c.beginUpdate(),c.setHeight(e+d),c.alignTo(this.outerWrapEl,this.listAlign),c.endUpdate(),this.multiSelectMode&&(a.scrollTop=b)},validateValue:function(a){return 0===this.items.getCount()?this.allowBlank?(this.clearInvalid(),!0):(this.markInvalid(this.blankText),!1):(this.clearInvalid(),!0)},manageNameAttribute:function(){0===this.items.getCount()&&this.forceFormValue?this.el.dom.setAttribute("name",this.hiddenName||this.name):this.el.dom.removeAttribute("name")},setupFormInterception:function(){var a;if(this.findParentBy(function(b){b.getForm&&(a=b.getForm())}),a){var b=a.getValues;a.getValues=function(c){this.el.dom.disabled=!0;var d=this.el.dom.value;this.setRawValue("");var e=b.call(a);return this.el.dom.disabled=!1,this.setRawValue(d),this.forceFormValue&&0===this.items.getCount()&&(e[this.name]=""),c?Ext.urlEncode(e):e}.createDelegate(this)}},onResize:function(a,b,c,d){var e=0;this.wrapEl&&(this._width=a,this.outerWrapEl.setWidth(a-e),this.renderFieldBtns&&(e+=this.buttonWrap.getWidth()+20,this.wrapEl.setWidth(a-e))),Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,a,b,c,d),this.autoSize()},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this),this.items.each(function(a){a.enable()}),this.renderFieldBtns&&this.initButtonEvents()},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this),this.items.each(function(a){a.disable()}),this.renderFieldBtns&&this.removeButtonEvents()},clearValue:function(a){return Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this),this.preventMultipleRemoveEvents=a||this.supressClearValueRemoveEvents||!1,this.removeAllItems(),this.preventMultipleRemoveEvents=!1,this.fireEvent("clear",this),this},onKeyUp:function(a){this.editable===!1||a.isSpecialKey()&&a.getKey()!==a.BACKSPACE||this.itemDelimiterKey.indexOf(a.getKey())!==-1||a.hasModifier()&&!a.shiftKey||(this.lastKey=a.getKey(),this.dqTask.delay(this.queryDelay))},onKeyDownHandler:function(a,b){var c,d,e;if((a.getKey()===a.DELETE||a.getKey()===a.SPACE)&&this.currentFocus)return a.stopEvent(),c=this.currentFocus,this.on("expand",function(){this.collapse()},this,{single:!0}),e=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),e<this.items.getCount()-1&&(d=this.items.itemAt(e+1)),c.preDestroy(!0),d&&function(){d.onLnkFocus(),this.currentFocus=d}.defer(200,this),!0;var g,f=this.el.dom.value,h=a.ctrlKey;if(this.itemDelimiterKey.indexOf(a.getKey())!==-1){if(a.stopEvent(),""!==f)h||!this.isExpanded()?(this.view.clearSelections(),this.collapse(),this.setRawValue(""),this.fireEvent("newitem",this,f)):this.onViewClick();else{if(!this.isExpanded())return;this.onViewClick()}return!0}return""!==f?void this.autoSize():a.getKey()===a.HOME?(a.stopEvent(),this.items.getCount()>0&&(this.collapse(),g=this.items.get(0),g.el.focus()),!0):a.getKey()===a.BACKSPACE?(a.stopEvent(),this.currentFocus?(c=this.currentFocus,this.on("expand",function(){this.collapse()},this,{single:!0}),e=this.items.indexOfKey(c.key),this.clearCurrentFocus(),e<this.items.getCount()-1&&(d=this.items.itemAt(e+1)),c.preDestroy(!0),void(d&&function(){d.onLnkFocus(),this.currentFocus=d}.defer(200,this))):(g=this.items.get(this.items.getCount()-1),g&&(this.backspaceDeletesLastItem?(this.on("expand",function(){this.collapse()},this,{single:!0}),g.preDestroy(!0)):this.navigateItemsWithTab?g.onElClick():this.on("expand",function(){this.collapse(),this.currentFocus=g,this.currentFocus.onLnkFocus.defer(20,this.currentFocus)},this,{single:!0})),!0)):a.isNavKeyPress()?a.getKey()===a.LEFT||a.getKey()===a.UP&&!this.isExpanded()?(a.stopEvent(),this.collapse(),g=this.items.get(this.items.getCount()-1),this.navigateItemsWithTab?g&&g.focus():this.currentFocus?(e=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),0!==e&&(this.currentFocus=this.items.itemAt(e-1),this.currentFocus.onLnkFocus())):(this.currentFocus=g,g&&g.onLnkFocus()),!0):a.getKey()===a.DOWN&&this.currentFocus?(this.collapse(),a.stopEvent(),e=this.items.indexOfKey(this.currentFocus.key),e==this.items.getCount()-1?this.clearCurrentFocus.defer(10,this):(this.clearCurrentFocus(),this.currentFocus=this.items.itemAt(e+1),this.currentFocus&&this.currentFocus.onLnkFocus()),!0):void(a.getKey()===a.RIGHT&&(this.collapse(),g=this.items.itemAt(0),this.navigateItemsWithTab?g&&g.focus():this.currentFocus?(e=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),e<this.items.getCount()-1&&(this.currentFocus=this.items.itemAt(e+1),this.currentFocus&&this.currentFocus.onLnkFocus())):(this.currentFocus=g,g&&g.onLnkFocus()))):(this.multiSelectMode=!1,void this.clearCurrentFocus())},onKeyUpBuffered:function(a){a.isNavKeyPress()||this.autoSize()},reset:function(){this.killItems(),Ext.ux.form.SuperBoxSelect.superclass.reset.call(this),this.addedRecords=[],this.autoSize().setRawValue("")},applyEmptyText:function(){return this.setRawValue(""),this.items.getCount()>0?(this.el.removeClass(this.emptyClass),this.setRawValue(""),this):(this.rendered&&this.emptyText&&this.getRawValue().length<1&&(this.setRawValue(this.emptyText),this.el.addClass(this.emptyClass)),this)},removeAllItems:function(){return this.items.each(function(a){a.preDestroy(!0)},this),this.manageClearBtn(),this},killItems:function(){return this.items.each(function(a){a.kill()},this),this.resetStore(),this.items.clear(),this.manageClearBtn(),this},resetStore:function(){return this.store.clearFilter(),this.removeValuesFromStore?(this.usedRecords.each(function(a){this.store.add(a)},this),this.usedRecords.clear(),this.sortStore(),this):this},sortStore:function(){var a=this.store.getSortState();return a&&a.field&&this.store.sort(a.field,a.direction),this},getCaption:function(a){"string"==typeof this.displayFieldTpl&&(this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl));var b,c=a instanceof Ext.data.Record?a.data:a;return this.displayFieldTpl?b=this.displayFieldTpl.apply(c):this.displayField&&(b=c[this.displayField]),b},addRecord:function(a){var b=a.data[this.displayField],c=this.getCaption(a),d=a.data[this.valueField],e=this.classField?a.data[this.classField]:"",f=this.styleField?a.data[this.styleField]:"";this.removeValuesFromStore&&(this.usedRecords.add(d,a),this.store.remove(a)),this.addItemBox(d,b,c,e,f),this.fireEvent("additem",this,d,a)},createRecord:function(a){if(!this.recordConstructor){var b=[{name:this.valueField},{name:this.displayField}];this.classField&&b.push({name:this.classField}),this.styleField&&b.push({name:this.styleField}),this.recordConstructor=Ext.data.Record.create(b)}return new this.recordConstructor(a)},addItems:function(a){Ext.isArray(a)?Ext.each(a,function(a){this.addItem(a)},this):this.addItem(a)},addNewItem:function(a){this.addItem(a,!0)},addItem:function(a,b){var c=a[this.valueField];if(this.disabled)return!1;if(!this.preventDuplicates||!this.hasValue(c)){var d=this.findRecord(this.valueField,c);if(d)return void this.addRecord(d);if(this.allowAddNewData){if(!this.allowAddNewData&&"remote"===this.mode)return this.remoteLookup.push(a),void this.doQuery(c,!1,!1,b);var e=this.createRecord(a);return this.store.add(e),this.addRecord(e),!0}}},addItemBox:function(a,b,c,d,e){var f,g=function(a){var b="";if("function"==typeof a)b=a.call();else if("object"==typeof a)for(var c in a)b+=c+":"+a[c]+";";else"string"==typeof a&&(b=a+";");return b},h=Ext.id(null,"sbx-item"),i=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+d,style:g(this.extraItemStyle)+" "+e,caption:c,display:b,value:a,key:h,listeners:{remove:function(a){this.fireEvent("beforeremoveitem",this,a.value)!==!1&&(this.items.removeKey(a.key),this.removeValuesFromStore&&this.usedRecords.containsKey(a.value)&&(this.store.add(this.usedRecords.get(a.value)),this.usedRecords.removeKey(a.value),this.sortStore(),this.view&&this.view.render()),this.preventMultipleRemoveEvents||this.fireEvent.defer(250,this,["removeitem",this,a.value,this.findInStore(a.value)]))},destroy:function(){this.collapse(),this.autoSize().manageClearBtn().validateValue()},scope:this}});i.render(),f={tag:"input",type:"hidden",value:Ext.util.Format.htmlEncode(a),name:this.hiddenName||this.name},this.disabled&&Ext.apply(f,{disabled:"disabled"}),i.hidden=this.el.insertSibling(f,"before"),this.items.add(h,i),this.applyEmptyText().autoSize().manageClearBtn().validateValue(),this.fireEvent("addItemBox",this,i)},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered)return this;var a="x-superboxselect-btn-hide";return 0===this.items.getCount()?this.buttonClear.addClass(a):this.buttonClear.removeClass(a),this},findInStore:function(a){var b=this.store.find(this.valueField,a);return b>-1&&this.store.getAt(b)},getValue:function(){var a=[];return this.items.each(function(b){a.push(b.value)}),a.join(this.valueDelimiter)},getValueEx:function(){var a=[];return this.items.each(function(b){var c={};c[this.valueField]=b.value,c[this.displayField]=b.display,this.classField&&(c[this.classField]=b.cls||""),this.styleField&&(c[this.styleField]=b.style||""),a.push(c)},this),a},initValue:function(){Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this),"remote"===this.mode&&(this.setOriginal=!0)},setValue:function(a){if(!this.rendered)return void(this.value=a);if(this.removeAllItems().resetStore(),this.remoteLookup=[],!Ext.isEmpty(a)){var b=a;if(Ext.isArray(a)||(a=""+a,b=a.split(this.valueDelimiter)),Ext.each(b,function(a){var b=this.findRecord(this.valueField,a);b?"remote"===this.mode&&this.remoteLookup.push(a):this.addRecord(b)},this),"remote"===this.mode){var c=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(c,!1,!0)}}},setValueEx:function(a){return this.removeAllItems().resetStore(),Ext.isArray(a)||(a=[a]),this.remoteLookup=[],this.allowAddNewData?void Ext.each(a,function(a){var b=this.findRecord(this.valueField,a[this.valueField])||this.createRecord(a);this.addRecord(b)},this):void Ext.each(a,function(a){this.addItem(a)},this)},hasValue:function(a){var b=!1;return this.items.each(function(c){if(c.value==a)return b=!0,!1},this),b},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==!1){var c=a.data[this.valueField];if(this.preventDuplicates&&this.hasValue(c))return;this.setRawValue(""),this.lastSelectionText="",this.fireEvent("beforeadditem",this,c)!==!1&&this.addRecord(a),0!==this.store.getCount()&&this.multiSelectMode?this.restrictHeight():this.collapse()}},onDestroy:function(){this.items.purgeListeners(),this.killItems(),this.renderFieldBtns&&Ext.destroy(this.buttonClear,this.buttonExpand,this.buttonWrap),Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl),Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)},autoSize:function(){if(!this.rendered)return this;this.metrics||(this.metrics=Ext.util.TextMetrics.createInstance(this.el));var a=this.el,b=a.dom.value,c=document.createElement("div");""===b&&this.emptyText&&this.items.getCount()<1&&(b=this.emptyText),c.appendChild(document.createTextNode(b)),b=c.innerHTML,c=null,b+="&#160;";var d=Math.max(this.metrics.getWidth(b)+24,24);return"undefined"!=typeof this._width&&(d=Math.min(this._width,d)),this.el.setWidth(d),this.fireEvent("autoSize",this),this},doQuery:function(a,b,c,d){a=Ext.isEmpty(a)?"":a;var e={query:a,forceAll:b,combo:this,cancel:!1};return this.fireEvent("beforequery",e)!==!1&&!e.cancel&&(a=e.query,b=e.forceAll,void((b===!0||a.length>=this.minChars||c&&!Ext.isEmpty(a))&&(this.lastQuery!==a||d?(this.lastQuery=a,"local"==this.mode?(this.selectedIndex=-1,b?this.store.clearFilter():this.store.filter(this.displayField,a),this.onLoad()):(this.store.baseParams[this.queryParam]=a,this.store.baseParams[this.queryValuesIndicator]=c,this.store.load({params:this.getParams(a)}),d||this.expand())):(this.selectedIndex=-1,this.onLoad()))))}}),Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect),Ext.ux.form.SuperBoxSelectItem=function(a){Ext.apply(this,a),Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)},Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)},onElClick:function(a){var b=this.owner;if(b.clearCurrentFocus().collapse(),b.navigateItemsWithTab)this.focus();else{b.el.dom.focus();(function(){this.onLnkFocus(),b.currentFocus=this}).defer(10,this)}},onElDblClick:function(a){this.owner.itemDlbClick&&this.owner.itemDlbClick(this,a),this.preDestroy(),this.owner.el.dom.value=this.value,this.owner.el.focus(!0)},onLnkClick:function(a){a&&a.stopEvent(),this.preDestroy(),this.owner.navigateItemsWithTab||this.owner.el.focus()},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus"),this.owner.outerWrapEl.addClass("x-form-focus")},onLnkBlur:function(){this.el.dom&&(this.el.removeClass("x-superboxselect-item-focus"),this.owner.outerWrapEl.removeClass("x-form-focus"))},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:!0}),this.el.on("dblclick",this.onElDblClick,this,{stopEvent:!0})},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})},enableAllListeners:function(){this.enableElListeners(),this.enableLnkListeners()},disableAllListeners:function(){this.el.removeAllListeners(),this.lnk.un("click",this.onLnkClick,this),this.lnk.un("focus",this.onLnkFocus,this),this.lnk.un("blur",this.onLnkBlur,this)},onRender:function(a,b){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,a,b);var c=this.el;c&&c.remove(),this.el=c=a.createChild({tag:"li"},a.last()),c.addClass("x-superboxselect-item");var d=this.owner.navigateItemsWithTab?Ext.isSafari?"button":"a":"span";this.key;Ext.apply(c,{focus:function(){var a=this.down(d+".x-superboxselect-item-close");a&&a.focus()},preDestroy:function(){this.preDestroy()}.createDelegate(this)}),this.enableElListeners(),c.update(this.caption);var f={tag:d,class:"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};"a"===d&&(f.href="#"),this.lnk=c.createChild(f),this.disabled?this.disableAllListeners():this.enableLnkListeners(),this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this}),this.setupKeyMap()},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right")},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left")},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var a=this.owner.items.get(0).el.focus();a&&a.el.focus()},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]),this.keyMap.stopEvent=!0},moveFocus:function(a){var b=this.el["left"==a?"prev":"next"]()||this.owner.el;b.focus.defer(100,b)},preDestroy:function(a){if(this.fireEvent("remove",this)!==!1){var b=function(){this.owner.navigateItemsWithTab&&this.moveFocus("right"),this.hidden.remove(),this.hidden=null,this.destroy()};return a?b.call(this):this.el.hide({duration:.2,callback:b,scope:this}),this}},kill:function(){this.hidden.remove(),this.hidden=null,this.purgeListeners(),this.destroy()},onDisable:function(){this.hidden&&this.hidden.dom.setAttribute("disabled","disabled"),this.keyMap.disable(),Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)},onEnable:function(){this.hidden&&this.hidden.dom.removeAttribute("disabled"),this.keyMap.enable(),Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)},onDestroy:function(){Ext.destroy(this.lnk,this.el),Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)}}),Ext.reg("superbox",Ext.ux.form.SuperBoxSelect);